---
description: Python coding conventions for Aggregato
globs: ["**/*.py"]
alwaysApply: false
---

# Python Conventions

## Type Hints

Use Python 3.13 type hints on ALL functions:

```python
# Good
def process_article(self, article: RawArticle, is_first: bool = False) -> str:
    """Process an article through the content pipeline."""
    pass

# Bad - missing types
def process_article(self, article, is_first=False):
    pass
```

## Docstrings

Use Google-style docstrings:

```python
def fetch_feed(url: str, timeout: int = 30) -> feedparser.FeedParserDict:
    """
    Fetch and parse an RSS feed.

    Args:
        url: The RSS feed URL
        timeout: Request timeout in seconds

    Returns:
        Parsed feed object

    Raises:
        ValueError: If URL is invalid
    """
```

## Logging

Use structured logging with context:

```python
import logging

logger = logging.getLogger(__name__)

# Good - includes context
logger.info(f"Processing article: {article.title} from {feed.name}")
logger.error(f"Failed to fetch {url}: {e}", exc_info=True)

# Bad - no context
logger.info("Processing article")
```

## Imports

Order: stdlib → third-party → local (enforced by ruff):

```python
import logging
from datetime import datetime
from typing import Any

from bs4 import BeautifulSoup
from django.utils import timezone

from aggregators.base import BaseAggregator
from core.models import Article, Feed
```

## HTML Sanitization

Always sanitize HTML content before storing:

```python
from aggregators.base import sanitize_html

# Removes scripts, iframes, dangerous elements
clean_html = sanitize_html(raw_html)
```

## Ruff Linting

Run before committing:

```bash
ruff check .           # Check for issues
ruff check --fix .     # Auto-fix issues
ruff format .          # Format code
```

Configuration in `pyproject.toml`. Key rules:
- E/W: pycodestyle
- F: Pyflakes
- I: isort (import sorting)
- B: flake8-bugbear
- UP: pyupgrade
